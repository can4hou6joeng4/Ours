# 开发进度交接文档 (2026-01-31 深度优化版)

## 🎨 当前视觉规范 (理物极简风)

- **主题色 (Primary)**: `#D4B185` (香槟金 - 用于核心数值与高亮)
- **底色 (Secondary)**: `#1A1A1A` (碳黑 - 用于看板与沉浸式组件)
- **背景 (Background)**: `#F8F8F8` (极简浅灰)
- **圆角规范**: 卡片与弹窗 `48rpx` / 胶囊标签 `30rpx`
- **交互核心**:
  - 全量毛玻璃蒙层 (`backdrop-filter: blur(25rpx)`)
  - 灵动悬浮呼吸感 (FAB 按钮动画：3s 周期 / 16rpx 振幅)
  - 仪式感弹窗动效：进入 (Pop-in 弹性)，退出 (Scale-down + Blur 渐隐，耗时 400ms)

## ✅ 已完成工作 (截至 2026-02-01)

### 1. 视觉增强与仪式感 (Visual & Ritual)
- **仪式感粒子动效**: 在首页全场景弹窗点击“我已收到”时，集成了基于 Canvas 2D 的金色粒子喷洒特效，提升了交互的反馈价值与情绪价值。
- **商店骨架屏优化**: 为商店页瀑布流布局实现了高性能骨架屏（Shimmer Effect），消除了图片加载时的页面跳动，优化了弱网环境下的首屏体验。

### 2. 功能完善 (Features)
- **背包全局搜索**: 在背包（Inventory）页面新增了关键字搜索功能，支持实时过滤礼品名称与描述，并与原有的堆叠逻辑完美兼容。

### 3. 云开发底层架构加固 (Stability) - (2026-01-31 前完成)
- **全量事务化**: 重构 `addTask` 和 `manageGift` 云函数，利用 `db.runTransaction` 确保“业务记录创建”与“仪式感通知写入”的原子性。
- **并发冲突防护**: 前端引入 `isSubmitting` 提交锁，配合 `Taro.showLoading`，杜绝重复提交。
- **监听器时序修复**: 优化 `index.tsx` 生命周期，确保 `initUser` 后再启动 `Watchers`。

## 🤖 AI 助手行为准则 (上下文基础)

> **接手 AI 请严格遵守以下规范：**

1. **对话语言**: 必须全程使用**中文**回答。
2. **Git 提交习惯**: 严格遵循 `"type: 中文信息"` 格式（例如：`fix: 修复监听器登录态校验逻辑`）。
   - **绝对禁止**: 提交信息中不能包含任何标识符（如 `Co-Authored-By` 等系统默认后缀）。
3. **固定回复后缀**: 每次回答的末尾必须携带语句：**“晚安 啵啵肠”**。
4. **代码风格**: 保持 React Hooks 习惯，样式需严格遵守理物风规范，优先使用 `Taro.cloud.callFunction`。

## 🚀 新设备接手步骤

1. 执行 `git pull` 获取最新提交。
2. **环境必做**:
   - **数据库集合**: 确保云开发控制台已有 `Notices` 集合。
   - **复合索引**: 为 `Notices` 集合添加 `idx_receiver_createTime` 和 `idx_receiver_read_createTime`。
   - **部署云函数**: 重新部署 `addTask` 和 `manageGift`。
3. 运行 `npm run dev:weapp` 启动预览。

## 📝 待办事项 (Next Steps)

- [ ] **数据可视化**: 在“我”页面增加积分变动的周/月趋势图表，增强获得感。
- [ ] **自定义皮肤**: 允许用户在“理物金”基础上选择几款限定的莫兰迪配色主题。
- [ ] **消息推送**: 集成微信订阅消息，当伴侣发布新任务或兑换礼品时，在微信外部也能感知。

晚安 啵啵肠
