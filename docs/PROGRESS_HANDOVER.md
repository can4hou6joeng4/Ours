# 开发进度交接文档 (2026-02-02 深度优化版)

## 🎨 当前视觉规范 (理物极简风)

- **主题色 (Primary)**: `#D4B185` (香槟金 - 用于核心数值与高亮)
- **底色 (Secondary)**: `#1A1A1A` (碳黑 - 用于看板与沉浸式组件)
- **背景 (Background)**: `#F8F8F8` (极简浅灰)
- **圆角规范**: 卡片与弹窗 `48rpx` / 胶囊标签 `30rpx`
- **交互核心**:
  - 全量毛玻璃蒙层 (`backdrop-filter: blur(25rpx)`)
  - 灵动悬浮呼吸感 (FAB 按钮动画：3s 周期 / 16rpx 振幅)
  - 仪式感弹窗动效：进入 (Pop-in 弹性)，退出 (Scale-down + Blur 渐隐，耗时 400ms)

## ✅ 已完成工作 (截至 2026-02-02)

### 1. 消息系统集成 (Messaging)
- **全场景订阅推送**: 完成了“新任务发布”、“任务完成”及“礼品使用申请”的微信推送链路。
- **后端权限加固**: 为 `addTask`、`updateTaskStatus`、`useItem` 云函数开启了 `subscribeMessage.send` 权限。
- **前端订阅管理**: 封装了 `src/utils/subscribe.ts` 工具类，采用“动作跟随型”触发策略，确保交互自然且合规。

### 2. 交互体验与规范适配 (UX & Compliance)
- **首页逻辑加固**: 实现了 "+" 按钮的前置绑定检查。未绑定伙伴时点击会弹出模态框引导至绑定页，避免无效操作。
- **消除视觉闪烁**: 重构了个人中心 `fetchUserInfo` 逻辑，支持“静默刷新”。解决了从微信资料选择器返回页面时全屏 Loading 导致的交互断层。
- **原生能力接入**: 昵称编辑框已适配 `type="nickname"`，支持微信一键填写建议。

### 3. 视觉增强与仪式感 (Visual & Ritual)
- **仪式感粒子动效**: 在首页全场景弹窗点击“我已收到”时，集成了基于 Canvas 2D 的金色粒子喷洒特效。
- **商店骨架屏优化**: 为商店页瀑布流布局实现了高性能骨架屏（Shimmer Effect）。

### 4. 云开发底层架构加固 (Stability)
- **全量事务化**: 重构核心云函数，利用 `db.runTransaction` 确保业务与通知的原子性。
- **并发冲突防护**: 前端引入 `isSubmitting` 提交锁，杜绝重复提交。

## 🤖 AI 助手行为准则 (上下文基础)

> **接手 AI 请严格遵守以下规范：**

1. **对话语言**: 必须全程使用**中文**回答。
2. **Git 提交习惯**: 严格遵循 `"type: 中文信息"` 格式（例如：`fix: 修复监听器登录态校验逻辑`）。
   - **绝对禁止**: 提交信息中不能包含任何标识符（如 `Co-Authored-By` 等系统默认后缀）。
3. **固定回复后缀**: 每次回答的末尾必须携带语句：**“晚安 啵啵肠”**。
4. **代码风格**: 保持 React Hooks 习惯，样式需严格遵守理物风规范，优先使用 `Taro.cloud.callFunction`。

## 🚀 新设备接手步骤

1. 执行 `git pull` 获取最新提交。
2. **环境必做**:
   - **数据库集合**: 确保云开发控制台已有 `Notices` 集合。
   - **配置订阅模板**: 按照 `docs/SUBSCRIPTION_DEPLOYMENT_GUIDE.md` 指引申请模板 ID 并填入 `src/utils/subscribe.ts`。
   - **部署云函数**: 重新部署 `addTask`、`updateTaskStatus`、`useItem` 以同步 OpenAPI 权限。
3. 运行 `npm run dev:weapp` 启动预览。

## 📝 待办事项 (Next Steps)

- [ ] **数据可视化**: 在“我”页面增加积分变动的周/月趋势图表，增强获得感。
- [ ] **自定义皮肤**: 允许用户在“理物金”基础上选择几款限定的莫兰迪配色主题。
- [x] **消息推送**: 集成微信订阅消息。 (已完成逻辑框架与占位实现)

晚安 啵啵肠
